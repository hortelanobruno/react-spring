<link href="/css/toolbar.css" rel="stylesheet" />
<script type="text/javascript">
	var urlAPIPrefix;

	$(document).ready(function() {
		urlAPIPrefix = "/ajax";
		loadUser();
	});// Fin funcion ready

	/**
	 * Carga el user logueado
	 *
	 */
	function loadUser() {
		var loggedUser = "admin";
		if (loggedUser === null) {
			loggedUser = "Anonymous";
		}
		$('#userLink').append(" " + loggedUser);
		$('#username').val(loggedUser);
	}
</script>
<nav class="navbar navbar-default navbar-callis" role="navigation">
	<!-- Collect the nav links, forms, and other content for toggling -->
	<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		<ul class="nav navbar-nav">
			<li><a href="/">Home</a></li>
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				data-toggle="dropdown">Tools <b class="caret"></b></a>
				<ul class="dropdown-menu" style="padding: 12px;">
					<li><a href="/networkNavigator">Network Navigator</a></li>
					<li><a href="/systemStatistics">System Statistics</a></li>
					<li><a href="/qoe/htur">HTTP QoE Transaction
							Analysis</a></li>
					<li><a href="/qoe/sur">Subscriber QoE Usage Analysis</a></li>
					<li><a href="/qoe/vtur">Video QoE Transaction
							Analysis</a></li>
					<li><a href="/reporter?domain=Dynamic_Services">Dynamic
							Services</a></li>
					<li><a href="/reporter?domain=InBrowser_Notification">In-Browser
							Notification</a></li>
					<li><a href="/reporter?domain=IPDR_Monitoring">IPDR
							Monitoring</a></li>
					<li><a href="/reporter?domain=Subscriber_Monitoring">Subscriber
							Monitoring</a></li>
					<li><a href="/reporter?domain=Traffic_Congestion">Traffic
							Congestion</a></li>
					<li><a href="/reporter?domain=Traffic_Monitoring">Traffic
							Monitoring</a></li>
					<li><a href="/reporter?domain=URL_Analysis">URL
							Analysis</a></li>
					<li><a href="/reporter?domain=Video_Monitoring">Video
							Monitoring</a></li>
					<li><a href="/dashboard">Dashboard</a></li>
					<li><a href="/sbm">Dashboard CAM</a></li>
					<li><a href="/reporter?domain=CAM">CAM Reports</a></li>
					<li><a href="/userControl">User Control</a></li>
					<li><a href="/userAudit">User Audit</a></li>
					<li><a href="/NAPsettings">CSM Analytics Settings</a></li>
					<li><a href="/dashVOD">Dashboard QoE</a></li>
				</ul></li>
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				data-toggle="dropdown">Help <b class="caret"></b></a>
				<ul class="dropdown-menu">
					<li><a href="/settings">Settings</a></li>
					<li><a href="/about">About</a></li>
				</ul></li>
		</ul>
		<ul class="nav navbar-nav navbar-right">
			<li class="dropdown"><a href="#" class="dropdown-toggle"
				id="userLink" data-toggle="dropdown"><i
					class="glyphicon glyphicon-user"></i><b class="caret"></b></a>
				<ul class="dropdown-menu">
					<li><a href="#" data-toggle="modal" data-backdrop="static"
						data-target="#editusermodal">Change Password</a></li>
					<li><a href="/logout">Logout</a></li>
				</ul></li>
		</ul>
	</div>
	<!-- /.navbar-collapse -->

</nav>

<div class="modal fade" id="editusermodal">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal">&times;</button>
				<h4 class="modal-title">Edit User</h4>
			</div>
			<div class="modal-body">
				<div class="panel panel-default">
					<div class="panel-body">
						<input type="hidden" class="form-control" id="username" value="" />
						<div class="form-group">
							<label>Current Password:</label> <input type="password"
								class="form-control" id="changePassword" />
						</div>
						<div class="form-group">
							<label>New Password:</label> <input type="password"
								class="form-control" id="newPassword" />
						</div>
						<div class="form-group">
							<label>Re-enter Password:</label> <input type="password"
								class="form-control" id="newPasswordRe" />
						</div>
					</div>
				</div>
			</div>
			<div class="alert alert-error" style="display: none"
				id="alertpassworduserdifferent" aria-labelledby="basicModal"
				aria-hidden="true">
				<h4>Warning!</h4>
				Password Don't Match!
			</div>
			<div class="alert alert-error" style="display: none"
				id="alertPasswordUserEmptyEdit" aria-labelledby="basicModal"
				aria-hidden="true">
				<h4>Warning!</h4>
				Password Can't be Empty!
			</div>
			<div class="alert alert-error" style="display: none"
				id="alertpasswordusercurrent" aria-labelledby="basicModal"
				aria-hidden="true">
				<h4>Warning!</h4>
				Invalid Current Password
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				<button type="button" class="btn btn-success"
					onclick="SubmitEditPassword();">Save changes</button>
			</div>
		</div>
	</div>
</div>
<script>
	function validateemptypassword(value) {
		$("#alertpassworduserdifferent").hide();
		$("#alertPasswordUserEmptyEdit").hide();
		if ($.trim(value) === '') {
			$("#alertPasswordUserEmpty").show();
			$("#alertPasswordUserEmptyEdit").show();
			return true;
		} else {
			return false;
		}
	}
	function validatepassworddifferent(value, value2) {
		$("#alertpassworduserdifferent").hide();
		$("#alertPasswordUserEmptyEdit").hide();
		if ($.trim(value) !== $.trim(value2)) {
			$("#alertPasswordUserDifferent").show();
			$("#alertpassworduserdifferent").show();
			return true;
		} else {
			return false;
		}
	}
	function SubmitEditPassword() {

		var username = $.trim($("#username").val());
		var changePassword = $("#changePassword").val();
		var newPassword = $("#newPassword").val();
		var newPasswordRe = $("#newPasswordRe").val();
		if (validateemptypassword(changePassword)
				|| validatepassworddifferent(newPassword, newPasswordRe)) {
			$("#alertpassworduserdifferent").show();
		} else {
			$.ajax({
				data : {
					"username" : username,
					"changePassword" : changePassword,
					"password" : newPassword
				},
				type : "post",
				url : "/ajax/editPassword",
				success : function(data) {
					if (data.errorCode === 1) {
						$("#editusermodal").modal('hide');
					} else if (data.errorCode === 0) {
						$("#alertpasswordusercurrent").show();
					} else if (data.errorCode === 2) {
						$("#alertpassworduserdifferent").show();
					}
				},
				error : function(response) {
					window.location = window.location.href;
				}
			});
		}
	}
</script>
